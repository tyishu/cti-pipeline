{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "canonical_cti",
  "type": "object",
  "required": ["id", "type", "observable_type", "value", "normalized_on", "sources", "diamond"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Canonical identifier, e.g., 'ip:198.51.100.25' or internal unique id"
    },
    "type": {
      "type": "string",
      "enum": ["indicator", "artifact", "event", "relationship"]
    },
    "observable_type": {
      "type": "string",
      "enum": ["ip", "domain", "url", "file", "process", "netflow", "cloud_event", "email"]
    },
    "value": {
      "type": "string",
      "description": "Normalized observable (lowercased domain, canonical IP, hex hash)"
    },
    "first_seen": {
      "type": ["string", "null"],
      "format": "date-time"
    },
    "last_seen": {
      "type": ["string", "null"],
      "format": "date-time"
    },
    "normalized_on": {
      "type": "string",
      "format": "date-time"
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "retrieved_at"],
        "properties": {
          "name": {"type": "string"},
          "feed_id": {"type": "string"},
          "url": {"type": "string"},
          "confidence": {"type": "number", "minimum": 0, "maximum": 100},
          "retrieved_at": {"type": "string", "format": "date-time"},
          "original_timestamp": {"type": ["string", "null"], "format": "date-time"},
          "notes": {"type": "string"}
        }
      }
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Feed-supplied or default confidence"
    },
    "score": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Internal computed priority score"
    },
    "evidence": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "kind": {"type": "string", "enum": ["sandbox", "static", "feed", "analysis", "other"]},
          "report_id": {"type": "string"},
          "summary": {"type": "string"}
        }
      }
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"}
    },
    "ttl": {
      "type": ["number", "null"],
      "description": "Expiry in seconds (optional)"
    },
    "provenance": {
      "type": "object",
      "properties": {
        "raw_id": {"type": "string"},
        "raw_payload_ref": {"type": "string"},
        "parser_version": {"type": "string"}
      }
    },
    "asset_relevance": {
      "type": "array",
      "items": {"type": "string"}
    },
    "raw_refs": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Private pointers to raw artifacts (private repo/vault)"
    },

    "diamond": {
      "type": "object",
      "description": "Diamond Model object (Adversary-Capability-Infrastructure-Victim). THIS OBJECT IS REQUIRED.",
      "required": ["diamond_id", "observed_time", "confidence", "provenance"],
      "properties": {
        "diamond_id": {"type": "string"},
        "adversary": {
          "type": "object",
          "properties": {
            "name": {"type": "string"},
            "aliases": {"type": "array", "items": {"type": "string"}},
            "confidence": {"type": "number", "minimum": 0, "maximum": 100},
            "references": {"type": "array", "items": {"type": "string"}}
          }
        },
        "capability": {
          "type": "object",
          "properties": {
            "type": {"type": "string", "description": "malware/tool/technique"},
            "name": {"type": "string"},
            "techniques": {"type": "array", "items": {"type": "string"}, "description": "ATT&CK ids e.g. T1059"},
            "evidence": {"type": "array", "items": {"type": "string"}}
          }
        },
        "infrastructure": {
          "type": "object",
          "properties": {
            "ips": {"type": "array", "items": {"type": "string"}},
            "domains": {"type": "array", "items": {"type": "string"}},
            "asn": {"type": ["integer", "null"]},
            "first_seen": {"type": ["string", "null"], "format": "date-time"}
          }
        },
        "victim": {
          "type": "object",
          "properties": {
            "org": {"type": "string"},
            "asset_tags": {"type": "array", "items": {"type": "string"}},
            "relevance": {"type": "number", "minimum": 0, "maximum": 1}
          }
        },
        "observed_time": {"type": "string", "format": "date-time"},
        "confidence": {"type": "number", "minimum": 0, "maximum": 100},
        "provenance": {"type": "array", "items": {"type": "string"}}
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
